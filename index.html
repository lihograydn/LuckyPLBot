<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS Case Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-secondary: #12121a;
            --card: #1a1a24;
            --border: #2a2a3a;
            --text: #e4e4e7;
            --muted: #71717a;
            --accent: #22d3ee;
            --accent-glow: rgba(34, 211, 238, 0.3);
            
            --consumer: #b0c3d9;
            --industrial: #5e98d9;
            --milspec: #4b69ff;
            --restricted: #8847ff;
            --classified: #d32ce6;
            --covert: #eb4b4b;
            --gold: #ffd700;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .font-display {
            font-family: 'Orbitron', sans-serif;
        }

        /* Animated background */
        .bg-grid {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(34, 211, 238, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34, 211, 238, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .bg-glow {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(150px);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
        }

        .glow-1 {
            top: -200px;
            left: -200px;
            background: var(--accent);
            animation: float 20s ease-in-out infinite;
        }

        .glow-2 {
            bottom: -200px;
            right: -200px;
            background: var(--covert);
            animation: float 25s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(100px, 50px); }
        }

        /* Navigation */
        .nav-container {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(10, 10, 15, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }

        .nav-btn {
            position: relative;
            padding: 1rem 2rem;
            font-weight: 600;
            color: var(--muted);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 8px;
        }

        .nav-btn:hover {
            color: var(--text);
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-btn.active {
            color: var(--accent);
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            height: 2px;
            background: var(--accent);
            box-shadow: 0 0 20px var(--accent);
        }

        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card:hover {
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Case card */
        .case-card {
            cursor: pointer;
            position: relative;
        }

        .case-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent 40%, rgba(34, 211, 238, 0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .case-card:hover::before {
            opacity: 1;
        }

        .case-image {
            width: 100%;
            height: 150px;
            object-fit: contain;
            padding: 1rem;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .case-card:hover .case-image {
            transform: scale(1.1) rotate(2deg);
        }

        /* Skin card */
        .skin-card {
            position: relative;
            overflow: hidden;
        }

        .skin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--rarity-color);
            box-shadow: 0 0 20px var(--rarity-color);
        }

        .skin-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
            padding: 0.5rem;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .skin-card:hover .skin-image {
            transform: scale(1.15);
        }

        /* Rarity colors */
        .rarity-consumer { --rarity-color: var(--consumer); }
        .rarity-industrial { --rarity-color: var(--industrial); }
        .rarity-milspec { --rarity-color: var(--milspec); }
        .rarity-restricted { --rarity-color: var(--restricted); }
        .rarity-classified { --rarity-color: var(--classified); }
        .rarity-covert { --rarity-color: var(--covert); }
        .rarity-gold { --rarity-color: var(--gold); }

        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #06b6d4);
            color: var(--bg);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.2));
            opacity: 0;
            transition: opacity 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--accent-glow);
        }

        .btn-primary:hover::before {
            opacity: 1;
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text);
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent);
        }

        .btn-sell {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .btn-sell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.4);
        }

        /* Case opening modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            max-width: 900px;
            width: 95%;
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        /* Roulette */
        .roulette-container {
            position: relative;
            overflow: hidden;
            border-radius: 12px;
            background: var(--bg);
            border: 2px solid var(--border);
            margin: 1.5rem 0;
        }

        .roulette-pointer {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            background: var(--accent);
            box-shadow: 0 0 30px var(--accent);
            z-index: 10;
        }

        .roulette-pointer::before,
        .roulette-pointer::after {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
        }

        .roulette-pointer::before {
            top: -2px;
            border-top-color: var(--accent);
        }

        .roulette-pointer::after {
            bottom: -2px;
            border-bottom-color: var(--accent);
        }

        .roulette-track {
            display: flex;
            gap: 4px;
            padding: 1rem 0;
            transition: transform 5s cubic-bezier(0.1, 0.7, 0.1, 1);
        }

        .roulette-item {
            flex-shrink: 0;
            width: 140px;
            height: 120px;
            background: var(--card);
            border-radius: 8px;
            border: 2px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
        }

        .roulette-item.winner {
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
            animation: pulse 1s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 30px var(--accent-glow); }
            50% { box-shadow: 0 0 50px var(--accent-glow); }
        }

        .roulette-item img {
            width: 100%;
            height: 80px;
            object-fit: contain;
        }

        /* Won item display */
        .won-item {
            text-align: center;
            padding: 2rem;
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .won-item-image {
            width: 300px;
            height: 200px;
            object-fit: contain;
            margin: 1rem auto;
            animation: floatItem 3s ease-in-out infinite;
        }

        @keyframes floatItem {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(2deg); }
        }

        /* Stats */
        .stat-card {
            background: linear-gradient(135deg, var(--card), var(--bg-secondary));
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* StatTrak badge */
        .stattrak-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: linear-gradient(135deg, #cf6a32, #de9900);
            color: #000;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            text-transform: uppercase;
        }

        /* Wear indicator */
        .wear-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
        }

        /* Page transitions */
        .page {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Profile avatar */
        .avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--covert));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: 900;
            color: white;
            box-shadow: 0 0 40px var(--accent-glow);
        }

        /* Balance animation */
        .balance-change {
            position: fixed;
            top: 100px;
            right: 20px;
            font-weight: 700;
            font-size: 1.25rem;
            pointer-events: none;
            animation: balanceFloat 2s ease-out forwards;
            z-index: 1000;
        }

        @keyframes balanceFloat {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-50px); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--muted);
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-btn {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .roulette-item {
                width: 100px;
                height: 90px;
            }
            
            .won-item-image {
                width: 200px;
                height: 140px;
            }
        }

        /* Pattern display */
        .pattern-tag {
            font-size: 0.6rem;
            padding: 0.15rem 0.3rem;
            border-radius: 3px;
            background: rgba(34, 211, 238, 0.2);
            color: var(--accent);
        }
    </style>
</head>
<body>
    <!-- Background effects -->
    <div class="bg-grid"></div>
    <div class="bg-glow glow-1"></div>
    <div class="bg-glow glow-2"></div>

    <!-- Navigation -->
    <nav class="nav-container">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <h1 class="font-display text-xl md:text-2xl font-bold tracking-wider">
                    <span class="text-cyan-400">CS</span> Case Simulator
                </h1>
                <div class="flex items-center gap-2 md:gap-4">
                    <button class="nav-btn active" data-page="profile">Профиль</button>
                    <button class="nav-btn" data-page="cases">Кейсы</button>
                    <button class="nav-btn" data-page="inventory">Инвентарь</button>
                </div>
                <div class="font-display text-lg md:text-xl font-bold text-green-400" id="balance-display">
                    $250.00
                </div>
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <main class="relative z-10 max-w-7xl mx-auto px-4 py-8">
        
        <!-- Profile Page -->
        <div id="page-profile" class="page active">
            <div class="text-center mb-8">
                <div class="avatar mx-auto mb-4">P</div>
                <h2 class="font-display text-3xl font-bold mb-2">Player</h2>
                <p class="text-gray-400">Симулятор кейсов CS2</p>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <div class="stat-card">
                    <div class="text-gray-400 text-sm mb-2">Баланс</div>
                    <div class="stat-value" id="stat-balance">$250.00</div>
                </div>
                <div class="stat-card">
                    <div class="text-gray-400 text-sm mb-2">Открыто кейсов</div>
                    <div class="stat-value" id="stat-cases">0</div>
                </div>
                <div class="stat-card">
                    <div class="text-gray-400 text-sm mb-2">Предметов</div>
                    <div class="stat-value" id="stat-items">0</div>
                </div>
                <div class="stat-card">
                    <div class="text-gray-400 text-sm mb-2">Выиграно</div>
                    <div class="stat-value" id="stat-won">$0.00</div>
                </div>
            </div>

            <div class="card p-6">
                <h3 class="font-display text-xl font-bold mb-4">История открытий</h3>
                <div id="history-list" class="space-y-2 max-h-80 overflow-y-auto">
                    <p class="text-gray-500 text-center py-8">Пока нет открытий</p>
                </div>
            </div>
        </div>

        <!-- Cases Page -->
        <div id="page-cases" class="page">
            <h2 class="font-display text-2xl font-bold mb-6 text-center">Выберите кейс</h2>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="cases-grid">
                <!-- Cases will be rendered here -->
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="page-inventory" class="page">
            <div class="flex items-center justify-between mb-6">
                <h2 class="font-display text-2xl font-bold">Инвентарь</h2>
                <div class="flex gap-2">
                    <button class="btn-secondary text-sm" id="sort-price">По цене</button>
                    <button class="btn-secondary text-sm" id="sort-rarity">По редкости</button>
                    <button class="btn-primary text-sm" id="sell-all">Продать всё</button>
                </div>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4" id="inventory-grid">
                <p class="text-gray-500 col-span-full text-center py-16">Инвентарь пуст</p>
            </div>
        </div>
    </main>

    <!-- Case Opening Modal -->
    <div class="modal-overlay" id="case-modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-display text-xl font-bold" id="modal-case-name">Открытие кейса</h3>
                <button class="text-gray-400 hover:text-white text-2xl" id="close-modal">&times;</button>
            </div>
            
            <!-- Roulette -->
            <div class="roulette-container" id="roulette-container" style="height: 150px;">
                <div class="roulette-pointer"></div>
                <div class="roulette-track" id="roulette-track">
                    <!-- Items will be rendered here -->
                </div>
            </div>

            <!-- Won item display -->
            <div class="won-item hidden" id="won-display">
                <div class="text-lg text-gray-400 mb-2">Вы получили:</div>
                <img src="" alt="" class="won-item-image" id="won-image">
                <h4 class="font-display text-2xl font-bold mb-1" id="won-name"></h4>
                <div class="flex items-center justify-center gap-2 mb-4">
                    <span class="wear-badge" id="won-wear"></span>
                    <span class="pattern-tag hidden" id="won-pattern"></span>
                </div>
                <div class="text-3xl font-bold mb-4" id="won-price"></div>
                <div class="flex gap-4 justify-center">
                    <button class="btn-primary" id="sell-won">Продать</button>
                    <button class="btn-secondary" id="keep-won">Оставить</button>
                </div>
            </div>

            <!-- Open button -->
            <div class="text-center" id="open-section">
                <button class="btn-primary text-lg px-8 py-3" id="open-case-btn">
                    Открыть за $<span id="case-price">0</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // ========== DATA ==========
        const WEAR_NAMES = {
            'fn': 'Прямо с завода',
            'mw': 'Немного поношенное',
            'ft': 'После полевых испытаний',
            'ww': 'Поношенное',
            'bs': 'Закалённое в боях'
        };

        const WEAR_RANGES = {
            'fn': [0.00, 0.07],
            'mw': [0.07, 0.15],
            'ft': [0.15, 0.38],
            'ww': [0.38, 0.45],
            'bs': [0.45, 1.00]
        };

        const RARITIES = {
            'consumer': { name: 'Ширпотреб', class: 'rarity-consumer', chance: 79.92 },
            'industrial': { name: 'Промышленное', class: 'rarity-industrial', chance: 0 },
            'milspec': { name: 'Армейское', class: 'rarity-milspec', chance: 79.92 },
            'restricted': { name: 'Запрещённое', class: 'rarity-restricted', chance: 15.98 },
            'classified': { name: 'Засекреченное', class: 'rarity-classified', chance: 3.2 },
            'covert': { name: 'Тайное', class: 'rarity-covert', chance: 0.64 },
            'gold': { name: 'Особый', class: 'rarity-gold', chance: 0.26 }
        };

        const SKINS_DATA = {
            'kilowatt': {
                name: 'Kilowatt Case',
                price: 3.50,
                image: 'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpot7HxfDhjxszJemkV09-5lpKKqPrxN7LEm1Rd6dd2j6eQ9N2t2wXl_EY-ZDz7I4eQdVQ4NQvT_Ae2xeu5hZe_7cjLzHR9-n51XzVSLRs0/256fx256f',
                skins: [
                    { name: 'P90', skin: 'Astral Jörmungandr', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.85 },
                    { name: 'MAG-7', skin: 'Demolition Crew', rarity: 'milspec', wears: ['fn', 'mw', 'ft'], basePrice: 0.45 },
                    { name: 'MAC-10', skin: 'Light Box', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.65 },
                    { name: 'MP5-SD', skin: 'Liquidation', rarity: 'milspec', wears: ['fn', 'mw', 'ft'], basePrice: 0.55 },
                    { name: 'XM1014', skin: 'Irezumi', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.75 },
                    { name: 'P250', skin: 'Re.built', rarity: 'milspec', wears: ['fn', 'mw', 'ft'], basePrice: 0.50 },
                    { name: 'G3SG1', skin: 'Dream Glade', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.80 },
                    { name: 'UMP-45', skin: 'Roadblock', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww'], basePrice: 3.20 },
                    { name: 'M4A4', skin: 'Temukau', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 4.50 },
                    { name: 'P2000', skin: 'Wicked Sick', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 3.80 },
                    { name: 'AWP', skin: 'Chrome Cannon', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 18.50 },
                    { name: 'USP-S', skin: 'Jawbreaker', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 22.00 },
                    { name: 'M4A1-S', skin: 'Black Lotus', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 85.00 },
                    { name: 'Kukri Knife', skin: 'Doppler', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 450, patterns: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Ruby', 'Sapphire', 'Black Pearl'] },
                    { name: 'Kukri Knife', skin: 'Fade', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 380, patterns: ['90/10', '80/20', '70/30', '50/50'] },
                    { name: 'Kukri Knife', skin: 'Marble Fade', rarity: 'gold', wears: ['fn'], basePrice: 420, patterns: ['Fire', 'Ice', 'Red'] }
                ]
            },
            'dreams': {
                name: 'Dreams & Nightmares Case',
                price: 2.20,
                image: 'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf3qr3czxb49KzgL-DjsjwN6vQglRc7cF4n-T--Y3nj1Hl_EQ9YWn3IYSdelc6YAvW-VTvlb3uhce_78mfyyBr7HNx7C3ZyRG0hUpOOLBthPSACQLJHuKQ/256fx256f',
                skins: [
                    { name: 'MP9', skin: 'Starlight Protector', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.95 },
                    { name: 'Tec-9', skin: 'Rebel', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.55 },
                    { name: 'MAG-7', skin: 'Foresight', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww'], basePrice: 0.45 },
                    { name: 'P250', skin: 'Cassette', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.50 },
                    { name: 'Galil AR', skin: 'Vandal', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.65 },
                    { name: 'SG 553', skin: 'Dragon Tech', rarity: 'milspec', wears: ['fn', 'mw', 'ft'], basePrice: 0.75 },
                    { name: 'XM1014', skin: 'Zombie Offensive', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.50 },
                    { name: 'Dual Berettas', skin: 'Melondrama', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.80 },
                    { name: 'AK-47', skin: 'Nightwish', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 5.50 },
                    { name: 'MP7', skin: 'Abyssal Apparition', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 3.20 },
                    { name: 'FAMAS', skin: 'Meow 36', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 12.50 },
                    { name: 'USP-S', skin: 'Ticket to Hell', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 28.00 },
                    { name: 'MP5-SD', skin: 'Necro Jr.', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 15.00 },
                    { name: 'AK-47', skin: 'Nightwish', rarity: 'covert', wears: ['fn', 'mw', 'ft'], basePrice: 95.00 },
                    { name: 'M4A1-S', skin: 'Printstream', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww'], basePrice: 120.00 },
                    { name: 'Butterfly Knife', skin: 'Doppler', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 1200, patterns: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Ruby', 'Sapphire'] },
                    { name: 'Butterfly Knife', skin: 'Fade', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 950, patterns: ['90/10', '80/20', 'Full Fade'] }
                ]
            },
            'fracture': {
                name: 'Fracture Case',
                price: 1.80,
                image: 'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf0ebcZThQ6tCvq4GGqOT1I6vZn3lU18h0juDU_Jn4xlXl-kRpYDj3cYSRcQA6NVnV-Vi4lbzuhZe9u5-fyXdquCMm5HfcnBOphxVObbYkN9bzGg/256fx256f',
                skins: [
                    { name: 'P250', skin: 'Cassette', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.50 },
                    { name: 'PP-Bizon', skin: 'Runic', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.35 },
                    { name: 'SG 553', skin: 'Ol\' Rusty', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.45 },
                    { name: 'P90', skin: 'Freight', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.60 },
                    { name: 'Tec-9', skin: 'Brother', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.55 },
                    { name: 'Negev', skin: 'Ultralight', rarity: 'milspec', wears: ['fn', 'mw', 'ft'], basePrice: 0.40 },
                    { name: 'SSG 08', skin: 'Mainframe 001', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.80 },
                    { name: 'MAC-10', skin: 'Allure', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 3.50 },
                    { name: 'Glock-18', skin: 'Vogue', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 6.50 },
                    { name: 'M4A4', skin: 'Tooth Fairy', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 5.20 },
                    { name: 'MAG-7', skin: 'Monster Call', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 8.50 },
                    { name: 'AWP', skin: 'Exoskeleton', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 25.00 },
                    { name: 'AK-47', skin: 'Legion of Anubis', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 75.00 },
                    { name: 'Desert Eagle', skin: 'Printstream', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww'], basePrice: 95.00 },
                    { name: 'Skeleton Knife', skin: 'Fade', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 650, patterns: ['90/10', '80/20', 'Full Fade'] },
                    { name: 'Nomad Knife', skin: 'Doppler', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 420, patterns: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Sapphire', 'Black Pearl'] }
                ]
            },
            'cs20': {
                name: 'CS20 Case',
                price: 2.50,
                image: 'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpopL-zJAt21uH3YjoX7Y-Jl5WHluH6MYrdl3hS4cAh2LmTo9-n0Qfh-Bc-Yj-ld9WVdVQ5aVyG8lDvkL3qgZ-9up-fynZmvnZ07XrZzRC1hBpNauJxxavJHAOJLeKTHsw/256fx256f',
                skins: [
                    { name: 'MP9', skin: 'Hydra', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.85 },
                    { name: 'P250', skin: 'Inferno', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.55 },
                    { name: 'Galil AR', skin: 'Connexion', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.65 },
                    { name: 'FAMAS', skin: 'Commemoration', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.95 },
                    { name: 'AUG', skin: 'Death by Puppy', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.45 },
                    { name: 'G3SG1', skin: 'Scavenger', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.35 },
                    { name: 'AWP', skin: 'Wildfire', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 8.50 },
                    { name: 'MP5-SD', skin: 'Agent', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 3.20 },
                    { name: 'P90', skin: 'Nostalgia', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.80 },
                    { name: 'M4A1-S', skin: 'Player Two', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 6.50 },
                    { name: 'Glock-18', skin: 'Sacrifice', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 15.00 },
                    { name: 'MP7', skin: 'Bloodsport', rarity: 'classified', wears: ['fn', 'mw', 'ft'], basePrice: 18.00 },
                    { name: 'AK-47', skin: 'Classic', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 150.00 },
                    { name: 'Classic Knife', skin: 'Doppler', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 550, patterns: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Sapphire', 'Ruby'] },
                    { name: 'Classic Knife', skin: 'Fade', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 480, patterns: ['90/10', 'Full Fade'] }
                ]
            },
            'danger': {
                name: 'Danger Zone Case',
                price: 1.50,
                image: 'https://community.cloudflare.steamstatic.com/economy/image/-9a81dlWLwJ2UUGcVs_nsVtzdOEdtWwKGZZLQHTxDZ7I56KU0Zwwo4NUX4oFJZEHLbXH5ApeO4YmlhxYQknCRvCo04DEVlxkKgpovbSsLQJf1ObcTjxP09C3h5KSkPLLP7LWnn8f6pIl3LrHo4ij21XkqkpsYzr3I4OVdVc7MF6D-ALowOy6gJe9up-fynBrsyBz-z-DyJm60h1Oc-sxvGaBHPAOJIKkXM/256fx256f',
                skins: [
                    { name: 'Glock-18', skin: 'Oxide Blaze', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.95 },
                    { name: 'Nova', skin: 'Plume', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.35 },
                    { name: 'SG 553', skin: 'Danger Close', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.45 },
                    { name: 'Tec-9', skin: 'Fubar', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.55 },
                    { name: 'M4A4', skin: 'Magnesium', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.75 },
                    { name: 'Sawed-Off', skin: 'Black Sand', rarity: 'milspec', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 0.30 },
                    { name: 'MP5-SD', skin: 'Phosphor', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.80 },
                    { name: 'G3SG1', skin: 'Scavenger', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 2.50 },
                    { name: 'Galil AR', skin: 'Signal', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 3.20 },
                    { name: 'Desert Eagle', skin: 'Mecha Industries', rarity: 'restricted', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 5.50 },
                    { name: 'USP-S', skin: 'Flashback', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 12.00 },
                    { name: 'MP9', skin: 'Modest Threat', rarity: 'classified', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 9.50 },
                    { name: 'AK-47', skin: 'Asiimov', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 85.00 },
                    { name: 'AWP', skin: 'Neo-Noir', rarity: 'covert', wears: ['fn', 'mw', 'ft', 'ww', 'bs'], basePrice: 45.00 },
                    { name: 'Stiletto Knife', skin: 'Doppler', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 380, patterns: ['Phase 1', 'Phase 2', 'Phase 3', 'Phase 4', 'Sapphire', 'Ruby'] },
                    { name: 'Talon Knife', skin: 'Fade', rarity: 'gold', wears: ['fn', 'mw'], basePrice: 520, patterns: ['90/10', '80/20', 'Full Fade'] }
                ]
            }
        };

        // ========== STATE ==========
        let state = {
            balance: 250,
            casesOpened: 0,
            totalWon: 0,
            inventory: [],
            history: [],
            currentCase: null,
            currentWonItem: null
        };

        // ========== HELPER FUNCTIONS ==========
        function formatPrice(price) {
            return '$' + price.toFixed(2);
        }

        function getSkinImage(weaponName, skinName) {
            const cleanName = `${weaponName} | ${skinName}`.replace(/ /g, '_');
            return `https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEa2wiPwfPT7cv0LaLBgOMVNggeP-0q8lqxjCJVgdV6NvX0qBV4ovF0Gw/256fx256f`;
        }

        function getKnifeImage(skinName) {
            return `https://community.cloudflare.steamstatic.com/economy/image/fWFc82js0fmoRAP-qOIPu5THSWqfSmTELLqcUywGkijVjZULUrsm1j-9xgEa2wiPwfPT7cv0LaLBgOMVNggeP-0q8lqxjCJVgdV6NvX0qBV4ovF0Gw/256fx256f`;
        }

        function generateFloat(wear) {
            const range = WEAR_RANGES[wear];
            return (range[0] + Math.random() * (range[1] - range[0])).toFixed(4);
        }

        function generatePattern(skin) {
            if (!skin.patterns) return null;
            return skin.patterns[Math.floor(Math.random() * skin.patterns.length)];
        }

        function isStatTrak() {
            return Math.random() < 0.10; // 10% chance
        }

        function calculatePrice(skin, wear, isStattrak, pattern) {
            let basePrice = skin.basePrice;
            
            // Wear multiplier
            const wearMultipliers = { 'fn': 1.5, 'mw': 1.2, 'ft': 1.0, 'ww': 0.8, 'bs': 0.6 };
            basePrice *= wearMultipliers[wear] || 1;
            
            // StatTrak multiplier
            if (isStattrak) {
                basePrice *= skin.rarity === 'gold' ? 1.3 : 2.5;
            }
            
            // Special pattern multiplier
            if (pattern) {
                if (pattern === 'Sapphire' || pattern === 'Ruby') {
                    basePrice *= 3;
                } else if (pattern === 'Full Fade') {
                    basePrice *= 1.5;
                }
            }
            
            // Random variance
            basePrice *= (0.9 + Math.random() * 0.2);
            
            return Math.max(0.05, basePrice);
        }

        function selectRandomSkin(caseData) {
            const rand = Math.random() * 100;
            let cumulative = 0;
            
            // Determine rarity
            let targetRarity = 'milspec';
            if (rand < 0.26) targetRarity = 'gold';
            else if (rand < 0.90) targetRarity = 'covert';
            else if (rand < 4.10) targetRarity = 'classified';
            else if (rand < 20.08) targetRarity = 'restricted';
            
            const skinsOfRarity = caseData.skins.filter(s => s.rarity === targetRarity);
            if (skinsOfRarity.length === 0) {
                return selectRandomSkin(caseData); // Retry with different rarity
            }
            
            const skin = skinsOfRarity[Math.floor(Math.random() * skinsOfRarity.length)];
            const wear = skin.wears[Math.floor(Math.random() * skin.wears.length)];
            const stattrak = isStatTrak();
            const pattern = generatePattern(skin);
            const float = generateFloat(wear);
            const price = calculatePrice(skin, wear, stattrak, pattern);
            
            return {
                weapon: skin.name,
                skin: skin.skin,
                rarity: skin.rarity,
                wear,
                float,
                stattrak,
                pattern,
                price,
                image: skin.rarity === 'gold' ? getKnifeImage(skin.skin) : getSkinImage(skin.name, skin.skin)
            };
        }

        // ========== RENDER FUNCTIONS ==========
        function renderCases() {
            const grid = document.getElementById('cases-grid');
            grid.innerHTML = '';
            
            Object.entries(SKINS_DATA).forEach(([id, caseData]) => {
                const card = document.createElement('div');
                card.className = 'card case-card';
                card.innerHTML = `
                    <div class="p-4">
                        <img src="${caseData.image}" alt="${caseData.name}" class="case-image">
                    </div>
                    <div class="p-4 border-t border-gray-800">
                        <h3 class="font-display font-bold text-center mb-2">${caseData.name}</h3>
                        <div class="text-center text-cyan-400 font-bold">${formatPrice(caseData.price)}</div>
                    </div>
                `;
                card.addEventListener('click', () => openCaseModal(id));
                grid.appendChild(card);
            });
        }

        function renderInventory() {
            const grid = document.getElementById('inventory-grid');
            
            if (state.inventory.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 col-span-full text-center py-16">Инвентарь пуст</p>';
                return;
            }
            
            grid.innerHTML = '';
            state.inventory.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = `card skin-card ${RARITIES[item.rarity].class}`;
                card.innerHTML = `
                    <div class="p-2">
                        <img src="${item.image}" alt="${item.weapon}" class="skin-image" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%231a1a24%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2250%22 fill=%22%23666%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2212%22>No Image</text></svg>'">
                    </div>
                    <div class="p-3 border-t border-gray-800">
                        <div class="flex items-center gap-1 mb-1">
                            ${item.stattrak ? '<span class="stattrak-badge">ST</span>' : ''}
                            <span class="text-xs text-gray-400 truncate">${item.weapon}</span>
                        </div>
                        <div class="text-sm font-semibold truncate">${item.skin}</div>
                        <div class="flex items-center gap-1 mt-1">
                            <span class="wear-badge">${WEAR_NAMES[item.wear]}</span>
                            ${item.pattern ? `<span class="pattern-tag">${item.pattern}</span>` : ''}
                        </div>
                        <div class="flex items-center justify-between mt-2">
                            <span class="font-bold text-green-400">${formatPrice(item.price)}</span>
                            <button class="btn-sell" onclick="sellItem(${index})">Продать</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            
            if (state.history.length === 0) {
                list.innerHTML = '<p class="text-gray-500 text-center py-8">Пока нет открытий</p>';
                return;
            }
            
            list.innerHTML = '';
            state.history.slice().reverse().forEach(item => {
                const div = document.createElement('div');
                div.className = `flex items-center gap-3 p-3 rounded-lg bg-gray-900/50 ${RARITIES[item.rarity].class}`;
                div.style.borderLeft = `3px solid var(--rarity-color)`;
                div.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            ${item.stattrak ? '<span class="stattrak-badge">ST</span>' : ''}
                            <span class="font-semibold">${item.weapon} | ${item.skin}</span>
                        </div>
                        <div class="text-sm text-gray-400">${WEAR_NAMES[item.wear]} ${item.pattern ? `• ${item.pattern}` : ''}</div>
                    </div>
                    <div class="font-bold text-green-400">${formatPrice(item.price)}</div>
                `;
                list.appendChild(div);
            });
        }

        function updateStats() {
            document.getElementById('balance-display').textContent = formatPrice(state.balance);
            document.getElementById('stat-balance').textContent = formatPrice(state.balance);
            document.getElementById('stat-cases').textContent = state.casesOpened;
            document.getElementById('stat-items').textContent = state.inventory.length;
            document.getElementById('stat-won').textContent = formatPrice(state.totalWon);
        }

        // ========== MODAL FUNCTIONS ==========
        function openCaseModal(caseId) {
            const caseData = SKINS_DATA[caseId];
            if (!caseData) return;
            
            if (state.balance < caseData.price) {
                showBalanceChange(-caseData.price, true);
                return;
            }
            
            state.currentCase = caseData;
            
            document.getElementById('modal-case-name').textContent = caseData.name;
            document.getElementById('case-price').textContent = caseData.price.toFixed(2);
            document.getElementById('case-modal').classList.add('active');
            
            // Reset UI
            document.getElementById('won-display').classList.add('hidden');
            document.getElementById('open-section').classList.remove('hidden');
            document.getElementById('roulette-track').style.transition = 'none';
            document.getElementById('roulette-track').style.transform = 'translateX(0)';
        }

        function closeCaseModal() {
            document.getElementById('case-modal').classList.remove('active');
            state.currentCase = null;
            state.currentWonItem = null;
        }

        function spinRoulette() {
            const caseData = state.currentCase;
            if (!caseData || state.balance < caseData.price) return;
            
            // Deduct cost
            state.balance -= caseData.price;
            state.casesOpened++;
            updateStats();
            showBalanceChange(-caseData.price);
            
            // Generate items for roulette
            const track = document.getElementById('roulette-track');
            const items = [];
            const winningIndex = 50; // Winner at position 50
            
            for (let i = 0; i < 100; i++) {
                if (i === winningIndex) {
                    state.currentWonItem = selectRandomSkin(caseData);
                    items.push(state.currentWonItem);
                } else {
                    items.push(selectRandomSkin(caseData));
                }
            }
            
            // Render items
            track.innerHTML = items.map(item => `
                <div class="roulette-item ${RARITIES[item.rarity].class}">
                    <img src="${item.image}" alt="${item.weapon}" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%231a1a24%22 width=%22100%22 height=%22100%22/></svg>'">
                    <div class="text-xs text-center truncate w-full">${item.weapon}</div>
                </div>
            `).join('');
            
            // Hide open button, start spin
            document.getElementById('open-section').classList.add('hidden');
            
            // Calculate offset
            const itemWidth = 144;
            const containerWidth = document.getElementById('roulette-container').offsetWidth;
            const offset = (winningIndex * itemWidth) - (containerWidth / 2) + (itemWidth / 2) + (Math.random() * 60 - 30);
            
            // Animate
            setTimeout(() => {
                track.style.transition = 'transform 5s cubic-bezier(0.1, 0.7, 0.1, 1)';
                track.style.transform = `translateX(-${offset}px)`;
            }, 50);
            
            // Show result
            setTimeout(() => {
                showWinResult();
            }, 5200);
        }

        function showWinResult() {
            const item = state.currentWonItem;
            if (!item) return;
            
            // Add to history
            state.history.push({...item});
            
            // Update total won
            state.totalWon += item.price;
            
            // Show result
            document.getElementById('won-display').classList.remove('hidden');
            document.getElementById('won-image').src = item.image;
            document.getElementById('won-image').onerror = function() {
                this.src = 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%231a1a24" width="100" height="100"/></svg>';
            };
            document.getElementById('won-name').textContent = `${item.weapon} | ${item.skin}`;
            document.getElementById('won-name').style.color = `var(--rarity-color)`;
            document.getElementById('won-name').className = `font-display text-2xl font-bold mb-1 ${RARITIES[item.rarity].class}`;
            document.getElementById('won-wear').textContent = WEAR_NAMES[item.wear];
            
            const patternEl = document.getElementById('won-pattern');
            if (item.pattern) {
                patternEl.textContent = item.pattern;
                patternEl.classList.remove('hidden');
            } else {
                patternEl.classList.add('hidden');
            }
            
            const stattrakText = item.stattrak ? 'StatTrak ' : '';
            document.getElementById('won-price').textContent = `${stattrakText}${formatPrice(item.price)}`;
            document.getElementById('won-price').style.color = item.stattrak ? '#cf6a32' : '#22c55e';
            
            updateStats();
            renderHistory();
        }

        function keepItem() {
            if (state.currentWonItem) {
                state.inventory.push(state.currentWonItem);
                renderInventory();
                updateStats();
            }
            closeCaseModal();
        }

        function sellWonItem() {
            if (state.currentWonItem) {
                state.balance += state.currentWonItem.price;
                showBalanceChange(state.currentWonItem.price);
                updateStats();
            }
            closeCaseModal();
        }

        function sellItem(index) {
            const item = state.inventory[index];
            if (item) {
                state.balance += item.price;
                state.inventory.splice(index, 1);
                showBalanceChange(item.price);
                updateStats();
                renderInventory();
            }
        }

        function sellAllItems() {
            if (state.inventory.length === 0) return;
            
            let total = 0;
            state.inventory.forEach(item => total += item.price);
            
            state.balance += total;
            showBalanceChange(total);
            state.inventory = [];
            updateStats();
            renderInventory();
        }

        function showBalanceChange(amount, isError = false) {
            const el = document.createElement('div');
            el.className = 'balance-change';
            el.style.color = isError ? '#ef4444' : (amount >= 0 ? '#22c55e' : '#ef4444');
            el.textContent = (amount >= 0 ? '+' : '') + formatPrice(amount);
            document.body.appendChild(el);
            
            setTimeout(() => el.remove(), 2000);
        }

        // ========== NAVIGATION ==========
        function switchPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`page-${pageId}`).classList.add('active');
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
        }

        // ========== SORTING ==========
        function sortByPrice() {
            state.inventory.sort((a, b) => b.price - a.price);
            renderInventory();
        }

        function sortByRarity() {
            const rarityOrder = ['gold', 'covert', 'classified', 'restricted', 'milspec', 'industrial', 'consumer'];
            state.inventory.sort((a, b) => rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity));
            renderInventory();
        }

        // ========== EVENT LISTENERS ==========
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => switchPage(btn.dataset.page));
        });

        document.getElementById('close-modal').addEventListener('click', closeCaseModal);
        document.getElementById('open-case-btn').addEventListener('click', spinRoulette);
        document.getElementById('keep-won').addEventListener('click', keepItem);
        document.getElementById('sell-won').addEventListener('click', sellWonItem);
        document.getElementById('sell-all').addEventListener('click', sellAllItems);
        document.getElementById('sort-price').addEventListener('click', sortByPrice);
        document.getElementById('sort-rarity').addEventListener('click', sortByRarity);

        // Close modal on overlay click
        document.getElementById('case-modal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeCaseModal();
        });

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeCaseModal();
            if (e.key === 'Enter' && state.currentCase && !state.currentWonItem) {
                spinRoulette();
            }
        });

        // ========== INIT ==========
        function init() {
            renderCases();
            renderInventory();
            renderHistory();
            updateStats();
        }

        init();
    </script>
</body>
</html>
