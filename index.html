<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GMinesBot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --card: #141420;
            --border: #1e1e2e;
            --accent: #00e676;
            --danger: #ff3d57;
            --muted: #5a5a7a;
            --text: #e8e8f0;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: linear-gradient(160deg, #08080c 0%, #0d0d15 50%, #08080c 100%);
            color: var(--text);
            min-height: 100vh;
            font-size: 14px;
            overflow-x: hidden;
        }

        .mono { font-family: 'JetBrains Mono', monospace; }

        /* Splash */
        #splash {
            position: fixed;
            inset: 0;
            background: linear-gradient(160deg, #08080c 0%, #0d0d15 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            transition: opacity 0.4s ease;
        }
        #splash.hide { opacity: 0; pointer-events: none; }
        
        .splash-text {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            color: var(--accent);
        }
        
        .dots {
            display: inline-flex;
            gap: 3px;
            margin-left: 6px;
        }
        
        .dots span {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: bounce 1.2s ease-in-out infinite;
        }
        .dots span:nth-child(2) { animation-delay: 0.15s; }
        .dots span:nth-child(3) { animation-delay: 0.3s; }
        
        @keyframes bounce {
            0%, 60%, 100% { transform: translateY(0); opacity: 0.4; }
            30% { transform: translateY(-10px); opacity: 1; }
        }

        /* App */
        #app { display: none; flex-direction: column; min-height: 100vh; }
        #app.active { display: flex; }

        /* Header */
        header {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: rgba(10,10,15,0.9);
            backdrop-filter: blur(8px);
            position: sticky;
            top: 0;
            z-index: 40;
        }

        .nickname {
            background: transparent;
            border: none;
            color: var(--accent);
            font-weight: 600;
            font-size: 1rem;
            outline: none;
            max-width: 140px;
        }
        
        .nickname:focus { border-bottom: 1px solid var(--accent); }

        .balance-display {
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Cards */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
        }

        /* Inputs */
        .input {
            background: #0d0d15;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 10px 12px;
            border-radius: 8px;
            width: 100%;
            outline: none;
            font-family: inherit;
            font-size: 14px;
        }
        .input:focus { border-color: var(--accent); }

        /* Buttons */
        .btn {
            background: var(--accent);
            color: #000;
            font-weight: 600;
            padding: 10px 16px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.2s;
        }
        .btn:hover { filter: brightness(1.1); }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .btn-danger { background: var(--danger); color: #fff; }
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }
        .btn-outline.active { border-color: var(--accent); color: var(--accent); }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10,10,15,0.95);
            border-top: 1px solid var(--border);
            padding: 8px 0;
            z-index: 40;
            backdrop-filter: blur(8px);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            color: var(--muted);
            cursor: pointer;
            padding: 6px 10px;
            transition: color 0.2s;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 10px; }

        /* Pages */
        .page { display: none; padding: 12px; padding-bottom: 70px; }
        .page.active { display: block; }

        /* Mines Grid */
        .mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
            margin: 12px 0;
        }
        
        .mine-cell {
            aspect-ratio: 1;
            background: #0d0d15;
            border: 1px solid var(--border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.15s;
        }
        .mine-cell:active { transform: scale(0.95); }
        .mine-cell.gem { background: rgba(0,230,118,0.15); border-color: var(--accent); }
        .mine-cell.bomb { background: rgba(255,61,87,0.15); border-color: var(--danger); }

        /* Crash */
        .crash-display {
            background: #0d0d15;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 12px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .crash-mult {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--accent);
        }
        .crash-mult.crashed { color: var(--danger); }

        /* History pills */
        .history-pill {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin: 2px;
        }
        .h-low { background: rgba(255,165,2,0.2); color: #ffa502; }
        .h-mid { background: rgba(0,230,118,0.2); color: var(--accent); }
        .h-high { background: rgba(0,200,255,0.2); color: #00c8ff; }

        /* Exchange */
        .exchange-row {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #0d0d15;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .exchange-row select {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px;
            border-radius: 6px;
            font-family: inherit;
            min-width: 70px;
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            z-index: 100;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
    </style>
</head>
<body>
    <!-- Splash -->
    <div id="splash">
        <div class="splash-text">
            gminesbot<span class="dots"><span></span><span></span><span></span></span>
        </div>
    </div>

    <!-- App -->
    <div id="app">
        <!-- Header -->
        <header>
            <div class="flex items-center justify-between mb-2">
                <input type="text" class="nickname" id="nickname" value="Player_7742" maxlength="16">
                <span class="text-xs text-[var(--muted)]">v2.1</span>
            </div>
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-xs text-[var(--muted)]">Баланс</div>
                    <div class="balance-display mono text-[var(--accent)]" id="balance">$15,000.00</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-[var(--muted)]">Профит</div>
                    <div class="mono font-semibold" id="profit">$0.00</div>
                </div>
            </div>
        </header>

        <!-- Profile Page -->
        <div class="page active" id="page-profile">
            <div class="card">
                <div class="text-xs text-[var(--muted)] mb-2">Статистика</div>
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div>
                        <div class="text-lg font-bold mono" id="stat-games">0</div>
                        <div class="text-xs text-[var(--muted)]">Игр</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold mono text-[var(--accent)]" id="stat-wins">0</div>
                        <div class="text-xs text-[var(--muted)]">Побед</div>
                    </div>
                    <div>
                        <div class="text-lg font-bold mono" id="stat-max">$0</div>
                        <div class="text-xs text-[var(--muted)]">Макс. выигрыш</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="text-xs text-[var(--muted)] mb-2">История</div>
                <div id="history-list" class="max-h-48 overflow-y-auto space-y-1">
                    <div class="text-center text-[var(--muted)] text-sm py-4">Пусто</div>
                </div>
            </div>
        </div>

        <!-- Bonus Page -->
        <div class="page" id="page-bonus">
            <div class="card">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <div class="font-semibold">Ежедневный бонус</div>
                        <div class="text-xs text-[var(--muted)]">Бесплатные $50</div>
                    </div>
                    <button class="btn" id="claim-btn">Забрать</button>
                </div>
            </div>
            
            <div class="card">
                <div class="text-xs text-[var(--muted)] mb-2">Промокод</div>
                <div class="flex gap-2">
                    <input type="text" class="input" id="promo-input" placeholder="Введите код">
                    <button class="btn" id="promo-btn">OK</button>
                </div>
                <div id="promo-msg" class="text-xs mt-2"></div>
            </div>
        </div>

        <!-- P2P Page -->
        <div class="page" id="page-p2p">
            <div class="card">
                <div class="text-xs text-[var(--muted)] mb-3">Ваши валюты</div>
                <div class="space-y-2" id="currency-list"></div>
            </div>
            
            <div class="card">
                <div class="text-xs text-[var(--muted)] mb-3">Обменять</div>
                
                <div class="exchange-row mb-2">
                    <select id="from-currency"></select>
                    <input type="number" class="input flex-1" id="from-amount" placeholder="Сумма">
                </div>
                
                <div class="text-center my-2 text-[var(--muted)]">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="inline">
                        <polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                        <polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                    </svg>
                </div>
                
                <div class="exchange-row mb-3">
                    <select id="to-currency"></select>
                    <div class="flex-1 mono text-right" id="to-amount">0.00</div>
                </div>
                
                <div class="text-xs text-[var(--muted)] mb-2" id="rate-info">Курс: 1 BTC = $67,500</div>
                
                <button class="btn w-full" id="exchange-btn">Обменять</button>
            </div>
        </div>

        <!-- Games Page -->
        <div class="page" id="page-games">
            <!-- Game Tabs -->
            <div class="flex gap-2 mb-3">
                <button class="btn btn-outline flex-1 active" data-game="crash">Crash</button>
                <button class="btn btn-outline flex-1" data-game="mines">Mines</button>
            </div>

            <!-- Crash Game -->
            <div id="crash-section">
                <div class="crash-display">
                    <div class="crash-mult mono" id="crash-mult">1.00x</div>
                    <div class="text-xs text-[var(--muted)] mt-1" id="crash-status">Ожидание ставки</div>
                </div>
                
                <div class="card">
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div>
                            <div class="text-xs text-[var(--muted)] mb-1">Ставка</div>
                            <input type="number" class="input mono" id="crash-bet" value="100">
                        </div>
                        <div>
                            <div class="text-xs text-[var(--muted)] mb-1">Авто-стоп</div>
                            <input type="number" class="input mono" id="crash-auto" value="2.00" step="0.1">
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn flex-1" id="crash-play">Играть</button>
                        <button class="btn btn-danger flex-1" id="crash-stop" disabled>Забрать</button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="text-xs text-[var(--muted)] mb-2">История</div>
                    <div id="crash-history" class="flex flex-wrap"></div>
                </div>
            </div>

            <!-- Mines Game -->
            <div id="mines-section" style="display:none">
                <div class="card">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs text-[var(--muted)]">Множитель</span>
                        <span class="mono font-bold text-[var(--accent)]" id="mines-mult">1.00x</span>
                    </div>
                    <div class="grid grid-cols-2 gap-2 mb-3">
                        <div>
                            <div class="text-xs text-[var(--muted)] mb-1">Ставка</div>
                            <input type="number" class="input mono" id="mines-bet" value="100">
                        </div>
                        <div>
                            <div class="text-xs text-[var(--muted)] mb-1">Мины (1-24)</div>
                            <input type="number" class="input mono" id="mines-count" value="3" min="1" max="24">
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="btn flex-1" id="mines-play">Играть</button>
                        <button class="btn btn-danger flex-1" id="mines-stop" disabled>Забрать</button>
                    </div>
                </div>
                
                <div class="mines-grid" id="mines-grid"></div>
            </div>
        </div>

        <!-- Bottom Nav -->
        <nav class="bottom-nav">
            <div class="flex justify-around">
                <div class="nav-item active" data-page="profile">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                    <span>Профиль</span>
                </div>
                <div class="nav-item" data-page="bonus">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                    <span>Бонус</span>
                </div>
                <div class="nav-item" data-page="p2p">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
                    <span>P2P</span>
                </div>
                <div class="nav-item" data-page="games">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="12" rx="2"/><circle cx="12" cy="12" r="2"/></svg>
                    <span>Игры</span>
                </div>
            </div>
        </nav>
    </div>

    <script>
        // === DATA ===
        const MULT = {
            1:[1.01,1.05,1.10,1.15,1.21,1.27,1.34,1.42,1.51,1.61,1.73,1.86,2.02,2.20,2.42,2.69,3.03,3.46,4.04,4.85,6.06,8.08,12.12,24.25],
            2:[1.05,1.15,1.26,1.38,1.53,1.70,1.90,2.14,2.42,2.77,3.19,3.73,4.40,5.29,6.46,8.08,10.39,13.85,19.40,29.10,48.50,97.00,291.00],
            3:[1.10,1.26,1.45,1.67,1.95,2.28,2.70,3.23,3.92,4.82,6.03,7.71,10.09,13.56,18.79,27.09,40.94,65.50,114.62,225.58,563.96,2255.83],
            4:[1.15,1.38,1.67,2.05,2.53,3.16,4.00,5.15,6.78,9.14,12.71,18.28,27.42,43.43,73.83,137.55,289.58,723.95,2292.52,11462.58,114625.83],
            5:[1.21,1.53,1.96,2.53,3.32,4.43,6.01,8.33,11.80,17.15,25.73,39.92,64.22,108.38,192.67,368.53,773.91,1934.78,6771.74,50788.04],
            6:[1.27,1.70,2.30,3.16,4.41,6.28,9.15,13.66,20.98,33.31,54.71,93.79,168.83,321.58,663.26,1525.50,4195.12,15382.11,169203.22],
            7:[1.34,1.90,2.73,4.00,5.98,9.16,14.42,23.42,39.26,68.21,123.63,238.16,494.34,1112.27,2780.68,8342.06,34758.58,451861.64],
            8:[1.42,2.14,3.28,5.15,8.33,13.89,23.95,42.75,79.53,154.21,312.43,676.93,1592.78,4247.42,13591.75,61162.88,1039769.00],
            9:[1.51,2.42,3.98,6.74,11.80,21.36,40.23,79.03,162.11,351.24,819.57,2091.13,5924.87,19552.07,83096.31,2077407.00],
            10:[1.61,2.77,4.95,9.29,18.28,37.74,82.11,188.85,464.87,1239.66,3636.33,12121.11,48484.44,266664.42,3199973.00],
            11:[1.73,3.19,6.19,12.71,27.58,63.66,158.45,431.14,1293.41,4526.96,18918.42,104051.34,832410.74,4330500.00],
            12:[1.86,3.73,7.96,18.28,45.71,125.72,384.47,1331.42,5325.71,26628.55,173085.60,1557770.40,5052250.00],
            13:[2.02,4.40,10.13,24.84,66.24,198.74,675.72,2533.95,11402.77,68416.65,615750.00,5052250.00],
            14:[2.20,5.29,13.60,38.25,119.53,418.37,1673.50,8032.81,50205.09,451845.83,4330500.00],
            15:[2.42,6.46,18.59,59.76,215.15,896.48,4333.00,25998.00,207984.00,3175700.00],
            16:[2.69,8.08,26.56,97.40,409.11,2045.55,12273.30,98186.44,1984812.00],
            17:[3.03,10.39,39.84,179.30,986.15,6574.34,55881.93,1047571.00],
            18:[3.46,13.85,63.74,366.52,2748.91,27489.13,465587.00],
            19:[4.04,19.40,111.55,818.04,8589.45,171789.00],
            20:[4.85,29.10,223.10,2454.10,51536.10],
            21:[6.06,48.50,557.75,12270.50],
            22:[8.08,97.00,2231.00],
            23:[12.12,291.00],
            24:[24.25]
        };

        const RATES = {
            USD: 1,
            BTC: 67500,
            ETH: 3450,
            USDT: 1,
            BNB: 580
        };

        const COLORS = { USD:'#00e676', BTC:'#f7931a', ETH:'#627eea', USDT:'#26a17b', BNB:'#f3ba2f' };

        // === STATE ===
        let state = {
            balance: 15000,
            profit: 0,
            games: 0,
            wins: 0,
            maxWin: 0,
            history: [],
            dailyClaimed: false
        };

        let currencies = {
            USD: 15000,
            BTC: 0.22,
            ETH: 3.5,
            USDT: 500,
            BNB: 8
        };

        let crash = { active: false, bet: 0, mult: 1, crashAt: 1, timer: null };
        let mines = { active: false, bet: 0, count: 3, field: [], revealed: 0, mult: 1 };
        let crashHistory = [];

        // === INIT ===
        setTimeout(() => {
            document.getElementById('splash').classList.add('hide');
            document.getElementById('app').classList.add('active');
            init();
        }, 2200);

        function init() {
            // Nav
            document.querySelectorAll('.nav-item').forEach(n => {
                n.onclick = () => {
                    document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
                    document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
                    n.classList.add('active');
                    document.getElementById('page-' + n.dataset.page).classList.add('active');
                };
            });

            // Game tabs
            document.querySelectorAll('[data-game]').forEach(b => {
                b.onclick = () => {
                    document.querySelectorAll('[data-game]').forEach(x => x.classList.remove('active'));
                    b.classList.add('active');
                    document.getElementById('crash-section').style.display = b.dataset.game === 'crash' ? 'block' : 'none';
                    document.getElementById('mines-section').style.display = b.dataset.game === 'mines' ? 'block' : 'none';
                };
            });

            initProfile();
            initBonus();
            initP2P();
            initCrash();
            initMines();
            updateUI();
        }

        // === PROFILE ===
        function initProfile() {
            document.getElementById('nickname').oninput = e => {
                document.getElementById('nickname').value = e.target.value.slice(0, 16);
            };
        }

        function updateUI() {
            document.getElementById('balance').textContent = fmt(state.balance);
            let p = document.getElementById('profit');
            p.textContent = (state.profit >= 0 ? '+' : '') + fmt(state.profit);
            p.style.color = state.profit >= 0 ? 'var(--accent)' : 'var(--danger)';
            
            document.getElementById('stat-games').textContent = state.games;
            document.getElementById('stat-wins').textContent = state.wins;
            document.getElementById('stat-max').textContent = fmt(state.maxWin);
        }

        function addHistory(type, amount) {
            state.history.unshift({ type, amount, time: Date.now() });
            if (state.history.length > 20) state.history.pop();
            
            let list = document.getElementById('history-list');
            if (state.history.length === 0) {
                list.innerHTML = '<div class="text-center text-[var(--muted)] text-sm py-4">Пусто</div>';
            } else {
                list.innerHTML = state.history.map(h => `
                    <div class="flex justify-between items-center py-1 text-sm">
                        <span>${h.type}</span>
                        <span class="mono ${h.amount >= 0 ? 'text-[var(--accent)]' : 'text-[var(--danger)]'}">${h.amount >= 0 ? '+' : ''}${fmt(h.amount)}</span>
                    </div>
                `).join('');
            }
        }

        // === BONUS ===
        function initBonus() {
            document.getElementById('claim-btn').onclick = () => {
                if (state.dailyClaimed) return toast('Уже получен', 'warning');
                state.dailyClaimed = true;
                state.balance += 50;
                document.getElementById('claim-btn').disabled = true;
                document.getElementById('claim-btn').textContent = 'Получено';
                addHistory('Бонус', 50);
                updateUI();
                toast('+$50', 'success');
            };

            document.getElementById('promo-btn').onclick = () => {
                let code = document.getElementById('promo-input').value.toUpperCase();
                let promos = { WELCOME: 100, GMINES: 250, VIP2024: 500 };
                let msg = document.getElementById('promo-msg');
                if (promos[code]) {
                    state.balance += promos[code];
                    addHistory('Промокод', promos[code]);
                    updateUI();
                    msg.innerHTML = `<span style="color:var(--accent)">+$${promos[code]}</span>`;
                    toast('Промокод активирован!', 'success');
                } else {
                    msg.innerHTML = '<span style="color:var(--danger)">Неверный код</span>';
                }
            };
        }

        // === P2P ===
        function initP2P() {
            updateCurrencyList();
            
            let fromSel = document.getElementById('from-currency');
            let toSel = document.getElementById('to-currency');
            
            Object.keys(currencies).forEach(c => {
                fromSel.innerHTML += `<option value="${c}">${c}</option>`;
                toSel.innerHTML += `<option value="${c}">${c}</option>`;
            });
            toSel.value = 'BTC';
            
            let calc = () => {
                let from = fromSel.value;
                let to = toSel.value;
                let amt = parseFloat(document.getElementById('from-amount').value) || 0;
                
                let usdVal = amt * RATES[from];
                let result = usdVal / RATES[to];
                document.getElementById('to-amount').textContent = result.toFixed(to === 'USD' || to === 'USDT' ? 2 : 6);
                document.getElementById('rate-info').textContent = `1 ${from} = ${(RATES[from]/RATES[to]).toFixed(to === 'USD' || to === 'USDT' ? 2 : 6)} ${to}`;
            };
            
            fromSel.onchange = calc;
            toSel.onchange = calc;
            document.getElementById('from-amount').oninput = calc;
            
            document.getElementById('exchange-btn').onclick = () => {
                let from = fromSel.value;
                let to = toSel.value;
                let amt = parseFloat(document.getElementById('from-amount').value) || 0;
                
                if (amt <= 0) return toast('Введите сумму', 'warning');
                if (currencies[from] < amt) return toast('Недостаточно', 'error');
                
                let usdVal = amt * RATES[from];
                let result = usdVal / RATES[to];
                
                currencies[from] -= amt;
                currencies[to] += result;
                
                if (from === 'USD') state.balance = currencies.USD;
                if (to === 'USD') state.balance = currencies.USD;
                
                addHistory(`Обмен ${from}>${to}`, 0);
                updateCurrencyList();
                updateUI();
                document.getElementById('from-amount').value = '';
                calc();
                toast('Обмен завершен', 'success');
            };
            
            calc();
        }

        function updateCurrencyList() {
            let list = document.getElementById('currency-list');
            list.innerHTML = Object.entries(currencies).map(([k, v]) => `
                <div class="flex justify-between items-center py-1">
                    <div class="flex items-center gap-2">
                        <span style="color:${COLORS[k]}; font-weight:600">${k}</span>
                    </div>
                    <span class="mono">${v.toFixed(k === 'USD' || k === 'USDT' ? 2 : 4)}</span>
                </div>
            `).join('');
        }

        // === CRASH ===
        function initCrash() {
            // Generate history
            for (let i = 0; i < 12; i++) {
                crashHistory.push((Math.random() * 8 + 1).toFixed(2));
            }
            updateCrashHistory();

            document.getElementById('crash-play').onclick = startCrash;
            document.getElementById('crash-stop').onclick = stopCrash;
        }

        function startCrash() {
            let bet = parseFloat(document.getElementById('crash-bet').value);
            if (bet <= 0) return toast('Введите ставку', 'warning');
            if (bet > state.balance) return toast('Недостаточно средств', 'error');
            
            state.balance -= bet;
            state.games++;
            updateUI();
            
            crash.active = true;
            crash.bet = bet;
            crash.mult = 1;
            crash.crashAt = 1 + Math.random() * 10;
            
            document.getElementById('crash-play').disabled = true;
            document.getElementById('crash-stop').disabled = false;
            document.getElementById('crash-bet').disabled = true;
            document.getElementById('crash-status').textContent = 'Играем...';
            document.getElementById('crash-mult').classList.remove('crashed');
            
            let autoStop = parseFloat(document.getElementById('crash-auto').value) || 999;
            
            crash.timer = setInterval(() => {
                crash.mult += 0.01 + (crash.mult - 1) * 0.003;
                document.getElementById('crash-mult').textContent = crash.mult.toFixed(2) + 'x';
                
                if (crash.mult >= autoStop) {
                    stopCrash();
                    return;
                }
                
                if (crash.mult >= crash.crashAt) {
                    crashLose();
                }
            }, 50);
        }

        function stopCrash() {
            if (!crash.active) return;
            clearInterval(crash.timer);
            crash.active = false;
            
            let win = crash.bet * crash.mult;
            state.balance += win;
            state.wins++;
            state.maxWin = Math.max(state.maxWin, win - crash.bet);
            state.profit += win - crash.bet;
            
            crashHistory.push(crash.mult.toFixed(2));
            addHistory('Crash +' + crash.mult.toFixed(2) + 'x', win - crash.bet);
            updateCrashHistory();
            
            document.getElementById('crash-play').disabled = false;
            document.getElementById('crash-stop').disabled = true;
            document.getElementById('crash-bet').disabled = false;
            document.getElementById('crash-status').textContent = '+' + fmt(win - crash.bet);
            
            updateUI();
            toast('Выигрыш ' + fmt(win), 'success');
        }

        function crashLose() {
            clearInterval(crash.timer);
            crash.active = false;
            
            state.profit -= crash.bet;
            
            crashHistory.push(crash.crashAt.toFixed(2));
            addHistory('Crash крах', -crash.bet);
            updateCrashHistory();
            
            document.getElementById('crash-mult').textContent = crash.crashAt.toFixed(2) + 'x';
            document.getElementById('crash-mult').classList.add('crashed');
            document.getElementById('crash-play').disabled = false;
            document.getElementById('crash-stop').disabled = true;
            document.getElementById('crash-bet').disabled = false;
            document.getElementById('crash-status').textContent = 'Краш!';
            
            updateUI();
        }

        function updateCrashHistory() {
            document.getElementById('crash-history').innerHTML = crashHistory.slice(-15).map(m => {
                let v = parseFloat(m);
                let cls = v < 2 ? 'h-low' : v < 5 ? 'h-mid' : 'h-high';
                return `<span class="history-pill mono ${cls}">${m}x</span>`;
            }).join('');
        }

        // === MINES ===
        function initMines() {
            buildMinesGrid();
            
            document.getElementById('mines-play').onclick = startMines;
            document.getElementById('mines-stop').onclick = stopMines;
        }

        function buildMinesGrid() {
            let grid = document.getElementById('mines-grid');
            grid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                let cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.dataset.idx = i;
                cell.onclick = () => clickMine(i);
                grid.appendChild(cell);
            }
        }

        function startMines() {
            let bet = parseFloat(document.getElementById('mines-bet').value);
            let count = parseInt(document.getElementById('mines-count').value);
            
            if (bet <= 0) return toast('Введите ставку', 'warning');
            if (count < 1 || count > 24) return toast('Мины: 1-24', 'warning');
            if (bet > state.balance) return toast('Недостаточно средств', 'error');
            
            state.balance -= bet;
            state.games++;
            updateUI();
            
            mines.active = true;
            mines.bet = bet;
            mines.count = count;
            mines.revealed = 0;
            mines.mult = 1;
            mines.field = Array(25).fill('gem');
            
            // Place mines
            let placed = 0;
            while (placed < count) {
                let idx = Math.floor(Math.random() * 25);
                if (mines.field[idx] === 'gem') {
                    mines.field[idx] = 'bomb';
                    placed++;
                }
            }
            
            // Reset grid
            document.querySelectorAll('.mine-cell').forEach(c => {
                c.className = 'mine-cell';
                c.innerHTML = '';
            });
            
            document.getElementById('mines-play').disabled = true;
            document.getElementById('mines-stop').disabled = false;
            document.getElementById('mines-bet').disabled = true;
            document.getElementById('mines-count').disabled = true;
            document.getElementById('mines-mult').textContent = '1.00x';
        }

        function clickMine(idx) {
            if (!mines.active) return;
            
            let cell = document.querySelector(`.mine-cell[data-idx="${idx}"]`);
            if (cell.classList.contains('gem') || cell.classList.contains('bomb')) return;
            
            if (mines.field[idx] === 'bomb') {
                // Lose
                cell.classList.add('bomb');
                cell.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--danger)" stroke-width="2"><circle cx="12" cy="12" r="8"/></svg>';
                
                // Reveal all
                mines.field.forEach((t, i) => {
                    if (t === 'bomb') {
                        let c = document.querySelector(`.mine-cell[data-idx="${i}"]`);
                        c.classList.add('bomb');
                        c.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--danger)" stroke-width="2"><circle cx="12" cy="12" r="8"/></svg>';
                    }
                });
                
                mines.active = false;
                state.profit -= mines.bet;
                addHistory('Mines крах', -mines.bet);
                
                document.getElementById('mines-play').disabled = false;
                document.getElementById('mines-stop').disabled = true;
                document.getElementById('mines-bet').disabled = false;
                document.getElementById('mines-count').disabled = false;
                
                updateUI();
                toast('Бум! -$' + mines.bet, 'error');
            } else {
                // Gem
                cell.classList.add('gem');
                cell.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="var(--accent)"><polygon points="12 2 15 9 22 9 17 14 19 21 12 17 5 21 7 14 2 9 9 9"/></svg>';
                
                mines.revealed++;
                
                // Update multiplier
                if (MULT[mines.count] && MULT[mines.count][mines.revealed - 1]) {
                    mines.mult = MULT[mines.count][mines.revealed - 1];
                }
                document.getElementById('mines-mult').textContent = mines.mult.toFixed(2) + 'x';
                
                // Check if all gems found
                if (mines.revealed >= 25 - mines.count) {
                    stopMines();
                }
            }
        }

        function stopMines() {
            if (!mines.active) return;
            mines.active = false;
            
            let win = mines.bet * mines.mult;
            state.balance += win;
            state.wins++;
            state.maxWin = Math.max(state.maxWin, win - mines.bet);
            state.profit += win - mines.bet;
            
            addHistory('Mines +' + mines.mult.toFixed(2) + 'x', win - mines.bet);
            
            document.getElementById('mines-play').disabled = false;
            document.getElementById('mines-stop').disabled = true;
            document.getElementById('mines-bet').disabled = false;
            document.getElementById('mines-count').disabled = false;
            
            updateUI();
            toast('Выигрыш ' + fmt(win), 'success');
        }

        // === UTILS ===
        function fmt(n) {
            return '$' + n.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function toast(msg, type) {
            let t = document.createElement('div');
            t.className = 'toast';
            t.style.background = type === 'success' ? 'var(--accent)' : type === 'error' ? 'var(--danger)' : '#ffa502';
            t.style.color = type === 'error' ? '#fff' : '#000';
            t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => t.remove(), 2000);
        }
    </script>
</body>
</html>
