<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mCoin Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0f;
            --bg-card: #12121a;
            --bg-elevated: #1a1a25;
            --fg: #e8e8ed;
            --muted: #6b6b7a;
            --accent: #f0b429;
            --accent-glow: rgba(240, 180, 41, 0.3);
            --danger: #ef4444;
            --success: #22c55e;
            --border: #2a2a3a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--bg);
            color: var(--fg);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        /* Background */
        .bg-pattern {
            position: fixed;
            inset: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(240, 180, 41, 0.08), transparent),
                radial-gradient(ellipse 60% 40% at 80% 100%, rgba(240, 180, 41, 0.05), transparent),
                linear-gradient(180deg, var(--bg) 0%, #0d0d14 100%);
            pointer-events: none;
            z-index: -1;
        }

        .grid-overlay {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 60px 60px;
            pointer-events: none;
            z-index: -1;
        }

        /* Navigation */
        .nav-item {
            position: relative;
            padding: 0.75rem 1.5rem;
            color: var(--muted);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border-radius: 8px;
        }

        .nav-item:hover {
            color: var(--fg);
            background: rgba(255,255,255,0.05);
        }

        .nav-item.active {
            color: var(--accent);
            background: rgba(240, 180, 41, 0.1);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 2px;
            background: var(--accent);
            border-radius: 2px;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(240, 180, 41, 0.3);
            box-shadow: 0 0 30px rgba(240, 180, 41, 0.05);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #d4a020);
            color: #0a0a0f;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--accent-glow);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-elevated);
            color: var(--fg);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--accent);
            background: rgba(240, 180, 41, 0.1);
        }

        /* Input */
        .input {
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.75rem 1rem;
            color: var(--fg);
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.2s ease;
            width: 100%;
        }

        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        /* Mine Grid */
        .mine-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            max-width: 350px;
            margin: 0 auto;
        }

        .mine-cell {
            aspect-ratio: 1;
            background: linear-gradient(145deg, #1e1e2a, #151520);
            border: 1px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .mine-cell:hover:not(.revealed):not(.game-over) {
            border-color: var(--accent);
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--accent-glow);
        }

        .mine-cell.revealed {
            background: linear-gradient(145deg, #252535, #1a1a28);
            cursor: default;
        }

        .mine-cell.gem {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            border-color: var(--success);
        }

        .mine-cell.mine {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            border-color: var(--danger);
        }

        .mine-cell.game-over {
            pointer-events: none;
        }

        /* Bonus cards */
        .bonus-card {
            background: linear-gradient(145deg, var(--bg-elevated), var(--bg-card));
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .bonus-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .bonus-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--accent), #d4a020);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
        }

        /* Timer */
        .timer {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.25rem;
            color: var(--accent);
        }

        /* Leaderboard */
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .leaderboard-item:hover {
            background: rgba(240, 180, 41, 0.1);
        }

        .leaderboard-item.top-1 {
            background: linear-gradient(90deg, rgba(240, 180, 41, 0.15), transparent);
            border-left: 3px solid var(--accent);
        }

        .rank {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .rank-1 { background: linear-gradient(135deg, #f0b429, #d4a020); color: #0a0a0f; }
        .rank-2 { background: linear-gradient(135deg, #94a3b8, #64748b); color: #0a0a0f; }
        .rank-3 { background: linear-gradient(135deg, #c2743a, #a05a2c); color: #fff; }
        .rank-other { background: var(--bg-card); color: var(--muted); }

        /* Section animations */
        .section {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Multiplier display */
        .multiplier {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            text-shadow: 0 0 20px var(--accent-glow);
        }

        /* Win/Lose animation */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes pulse-win {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 20px rgba(34, 197, 94, 0); }
        }

        /* Responsive */
        @media (max-width: 640px) {
            .nav-item {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
            
            .mine-grid {
                max-width: 280px;
                gap: 6px;
            }
            
            .mine-cell {
                border-radius: 8px;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="grid-overlay"></div>

    <!-- Header -->
    <header class="sticky top-0 z-50 backdrop-blur-xl bg-[#0a0a0f]/80 border-b border-[#2a2a3a]">
        <div class="max-w-4xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-[#f0b429] to-[#d4a020] flex items-center justify-center">
                        <span class="text-black font-bold text-sm">m</span>
                    </div>
                    <span class="font-bold text-lg">mCoin</span>
                </div>
                <div class="flex items-center gap-1 bg-[#12121a] rounded-full px-3 py-1 border border-[#2a2a3a]">
                    <svg class="w-4 h-4 text-[#f0b429]" fill="currentColor" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                    </svg>
                    <span id="header-balance" class="mono font-bold text-sm">1000.00</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="max-w-4xl mx-auto px-4 py-4">
        <div class="flex justify-center gap-2 flex-wrap">
            <div class="nav-item active" data-section="profile">Профиль</div>
            <div class="nav-item" data-section="bonus">Бонусы</div>
            <div class="nav-item" data-section="games">Игры</div>
            <div class="nav-item" data-section="top">Топ</div>
        </div>
    </nav>

    <main class="max-w-4xl mx-auto px-4 pb-8">
        <!-- Profile Section -->
        <section id="profile" class="section active">
            <div class="card max-w-md mx-auto">
                <div class="flex items-center gap-4 mb-6">
                    <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-[#f0b429] to-[#d4a020] flex items-center justify-center">
                        <svg class="w-10 h-10 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                    <div class="flex-1">
                        <p class="text-[#6b6b7a] text-sm mb-1">Добро пожаловать</p>
                        <h2 id="display-nickname" class="text-2xl font-bold">Игрок</h2>
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm text-[#6b6b7a] mb-2">Никнейм</label>
                    <div class="flex gap-2">
                        <input type="text" id="nickname-input" class="input" placeholder="Введите никнейм" maxlength="20">
                        <button id="save-nickname" class="btn btn-primary">Сохранить</button>
                    </div>
                </div>

                <div class="bg-[#1a1a25] rounded-xl p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-[#6b6b7a] text-sm mb-1">Ваш баланс</p>
                            <div class="flex items-center gap-2">
                                <svg class="w-6 h-6 text-[#f0b429]" fill="currentColor" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10"/>
                                </svg>
                                <span id="profile-balance" class="mono text-3xl font-bold">1000.00</span>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-[#6b6b7a] text-sm">mCoin</p>
                        </div>
                    </div>
                </div>

                <div class="mt-6 pt-6 border-t border-[#2a2a3a]">
                    <h3 class="font-bold mb-3">Статистика</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-[#1a1a25] rounded-xl p-3 text-center">
                            <p class="text-2xl font-bold text-[#22c55e]" id="stats-wins">0</p>
                            <p class="text-sm text-[#6b6b7a]">Побед</p>
                        </div>
                        <div class="bg-[#1a1a25] rounded-xl p-3 text-center">
                            <p class="text-2xl font-bold text-[#ef4444]" id="stats-losses">0</p>
                            <p class="text-sm text-[#6b6b7a]">Поражений</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Bonus Section -->
        <section id="bonus" class="section">
            <div class="grid md:grid-cols-2 gap-6 max-w-2xl mx-auto">
                <div class="bonus-card">
                    <div class="bonus-icon">
                        <svg class="w-7 h-7 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Базовый бонус</h3>
                    <p class="text-[#6b6b7a] text-sm mb-4">Раз в час</p>
                    <p class="text-2xl font-bold text-[#22c55e] mb-4">+50 mCoin</p>
                    <p class="timer mb-4" id="hourly-timer">00:00:00</p>
                    <button id="hourly-bonus" class="btn btn-primary w-full">Забрать</button>
                </div>

                <div class="bonus-card">
                    <div class="bonus-icon">
                        <svg class="w-7 h-7 text-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Ежедневный бонус</h3>
                    <p class="text-[#6b6b7a] text-sm mb-4">Раз в 24 часа</p>
                    <p class="text-2xl font-bold text-[#22c55e] mb-4">+500 mCoin</p>
                    <p class="timer mb-4" id="daily-timer">00:00:00</p>
                    <button id="daily-bonus" class="btn btn-primary w-full">Забрать</button>
                </div>
            </div>
        </section>

        <!-- Games Section -->
        <section id="games" class="section">
            <div class="card max-w-lg mx-auto">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold">Мины</h2>
                    <div class="text-right">
                        <p class="text-sm text-[#6b6b7a]">Множитель</p>
                        <p class="multiplier" id="multiplier">1.00x</p>
                    </div>
                </div>

                <!-- Game Controls -->
                <div class="grid grid-cols-2 gap-4 mb-6" id="game-controls">
                    <div>
                        <label class="block text-sm text-[#6b6b7a] mb-2">Ставка</label>
                        <input type="number" id="bet-amount" class="input mono" value="10" min="1" step="1">
                    </div>
                    <div>
                        <label class="block text-sm text-[#6b6b7a] mb-2">Мины (1-24)</label>
                        <input type="number" id="mines-count" class="input mono" value="5" min="1" max="24">
                    </div>
                </div>

                <!-- Game Status -->
                <div class="bg-[#1a1a25] rounded-xl p-3 mb-6 text-center" id="game-status">
                    <p class="text-[#6b6b7a]">Начните игру</p>
                </div>

                <!-- Mine Grid -->
                <div class="mine-grid mb-6" id="mine-grid"></div>

                <!-- Game Buttons -->
                <div class="flex gap-3">
                    <button id="start-game" class="btn btn-primary flex-1">Начать игру</button>
                    <button id="cashout-btn" class="btn btn-secondary flex-1" disabled>Забрать</button>
                </div>
            </div>
        </section>

        <!-- Top Section -->
        <section id="top" class="section">
            <div class="card max-w-md mx-auto">
                <h2 class="text-xl font-bold mb-6 text-center">Топ игроков</h2>
                <div id="leaderboard"></div>
            </div>
        </section>
    </main>

    <script>
        // ========== DATA ==========
        const DEFAULT_DATA = {
            nickname: 'Игрок',
            balance: 1000,
            wins: 0,
            losses: 0,
            hourlyBonusTime: 0,
            dailyBonusTime: 0
        };

        let gameData = { ...DEFAULT_DATA };

        // Fake leaderboard data
        const fakePlayers = [
            { name: 'ProGamer', balance: 125000 },
            { name: 'LuckyMan', balance: 89500 },
            { name: 'MineKing', balance: 67200 },
            { name: 'CoinMaster', balance: 45300 },
            { name: 'RiskTaker', balance: 32100 },
            { name: 'DiamondHand', balance: 28700 },
            { name: 'SpeedRunner', balance: 19400 },
            { name: 'NightOwl', balance: 12300 },
            { name: 'StarPlayer', balance: 8900 }
        ];

        // ========== GAME STATE ==========
        let gameState = {
            isPlaying: false,
            bet: 0,
            minesCount: 5,
            mines: [],
            revealed: 0,
            multiplier: 1,
            gameOver: false
        };

        // ========== DOM ELEMENTS ==========
        const navItems = document.querySelectorAll('.nav-item');
        const sections = document.querySelectorAll('.section');

        // Profile
        const nicknameInput = document.getElementById('nickname-input');
        const displayNickname = document.getElementById('display-nickname');
        const saveNicknameBtn = document.getElementById('save-nickname');
        const profileBalance = document.getElementById('profile-balance');
        const headerBalance = document.getElementById('header-balance');
        const statsWins = document.getElementById('stats-wins');
        const statsLosses = document.getElementById('stats-losses');

        // Bonus
        const hourlyBonusBtn = document.getElementById('hourly-bonus');
        const dailyBonusBtn = document.getElementById('daily-bonus');
        const hourlyTimer = document.getElementById('hourly-timer');
        const dailyTimer = document.getElementById('daily-timer');

        // Game
        const mineGrid = document.getElementById('mine-grid');
        const betAmount = document.getElementById('bet-amount');
        const minesCountInput = document.getElementById('mines-count');
        const startGameBtn = document.getElementById('start-game');
        const cashoutBtn = document.getElementById('cashout-btn');
        const multiplierDisplay = document.getElementById('multiplier');
        const gameStatus = document.getElementById('game-status');
        const gameControls = document.getElementById('game-controls');

        // ========== FUNCTIONS ==========

        // Save/Load
        function saveData() {
            localStorage.setItem('mcoin_game', JSON.stringify(gameData));
        }

        function loadData() {
            const saved = localStorage.getItem('mcoin_game');
            if (saved) {
                gameData = { ...DEFAULT_DATA, ...JSON.parse(saved) };
            }
        }

        function updateUI() {
            displayNickname.textContent = gameData.nickname;
            nicknameInput.value = gameData.nickname;
            profileBalance.textContent = gameData.balance.toFixed(2);
            headerBalance.textContent = gameData.balance.toFixed(2);
            statsWins.textContent = gameData.wins;
            statsLosses.textContent = gameData.losses;
        }

        // Navigation
        function switchSection(sectionId) {
            navItems.forEach(item => {
                item.classList.toggle('active', item.dataset.section === sectionId);
            });
            sections.forEach(section => {
                section.classList.toggle('active', section.id === sectionId);
            });

            if (sectionId === 'top') {
                renderLeaderboard();
            }
        }

        // Timer formatting
        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 3600 % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // Bonus timers
        function updateBonusTimers() {
            const now = Math.floor(Date.now() / 1000);
            
            // Hourly bonus
            const hourlyRemaining = Math.max(0, gameData.hourlyBonusTime - now);
            hourlyTimer.textContent = formatTime(hourlyRemaining);
            hourlyBonusBtn.disabled = hourlyRemaining > 0;
            hourlyBonusBtn.textContent = hourlyRemaining > 0 ? 'Ждите' : 'Забрать';

            // Daily bonus
            const dailyRemaining = Math.max(0, gameData.dailyBonusTime - now);
            dailyTimer.textContent = formatTime(dailyRemaining);
            dailyBonusBtn.disabled = dailyRemaining > 0;
            dailyBonusBtn.textContent = dailyRemaining > 0 ? 'Ждите' : 'Забрать';
        }

        function claimHourlyBonus() {
            const now = Math.floor(Date.now() / 1000);
            if (now >= gameData.hourlyBonusTime) {
                gameData.balance += 50;
                gameData.hourlyBonusTime = now + 3600;
                saveData();
                updateUI();
                updateBonusTimers();
                showNotification('+50 mCoin', 'success');
            }
        }

        function claimDailyBonus() {
            const now = Math.floor(Date.now() / 1000);
            if (now >= gameData.dailyBonusTime) {
                gameData.balance += 500;
                gameData.dailyBonusTime = now + 86400;
                saveData();
                updateUI();
                updateBonusTimers();
                showNotification('+500 mCoin', 'success');
            }
        }

        // Notifications
        function showNotification(message, type) {
            const colors = {
                success: 'bg-[#22c55e]',
                error: 'bg-[#ef4444]',
                info: 'bg-[#f0b429]'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-20 left-1/2 -translate-x-1/2 ${colors[type]} text-black px-6 py-3 rounded-xl font-bold z-50`;
            notification.textContent = message;
            notification.style.animation = 'fadeIn 0.3s ease';
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // ========== MINES GAME ==========

        function createGrid() {
            mineGrid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'mine-cell';
                cell.dataset.index = i;
                mineGrid.appendChild(cell);
            }
        }

        function calculateMultiplier(mines, revealed) {
            if (revealed === 0) return 1;
            const safeSpots = 25 - mines;
            let mult = 1;
            for (let i = 0; i < revealed; i++) {
                mult *= (25 - mines - i) / (safeSpots - i);
                mult = 1 / mult;
            }
            return Math.max(1, mult * 0.97); // 3% house edge
        }

        function startGame() {
            const bet = parseFloat(betAmount.value);
            const mines = parseInt(minesCountInput.value);

            if (isNaN(bet) || bet < 1) {
                showNotification('Введите корректную ставку', 'error');
                return;
            }

            if (bet > gameData.balance) {
                showNotification('Недостаточно средств', 'error');
                return;
            }

            if (isNaN(mines) || mines < 1 || mines > 24) {
                showNotification('Количество мин: 1-24', 'error');
                return;
            }

            // Deduct bet
            gameData.balance -= bet;
            updateUI();
            saveData();

            // Setup game state
            gameState = {
                isPlaying: true,
                bet: bet,
                minesCount: mines,
                mines: [],
                revealed: 0,
                multiplier: 1,
                gameOver: false
            };

            // Generate mine positions
            const positions = [];
            while (positions.length < mines) {
                const pos = Math.floor(Math.random() * 25);
                if (!positions.includes(pos)) {
                    positions.push(pos);
                }
            }
            gameState.mines = positions;

            // Reset UI
            createGrid();
            multiplierDisplay.textContent = '1.00x';
            gameStatus.innerHTML = `<p class="text-[#f0b429]">Игра началась! Открывайте клетки</p>`;
            startGameBtn.disabled = true;
            cashoutBtn.disabled = false;
            betAmount.disabled = true;
            minesCountInput.disabled = true;

            // Add cell click handlers
            document.querySelectorAll('.mine-cell').forEach(cell => {
                cell.addEventListener('click', handleCellClick);
            });
        }

        function handleCellClick(e) {
            if (!gameState.isPlaying || gameState.gameOver) return;
            
            const cell = e.target;
            const index = parseInt(cell.dataset.index);

            if (cell.classList.contains('revealed')) return;

            cell.classList.add('revealed');

            if (gameState.mines.includes(index)) {
                // Hit mine - lose
                cell.classList.add('mine');
                cell.innerHTML = `<svg class="w-6 h-6 text-[#ef4444]" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg>`;
                endGame(false);
            } else {
                // Safe - continue
                cell.classList.add('gem');
                cell.innerHTML = `<svg class="w-6 h-6 text-[#22c55e]" fill="currentColor" viewBox="0 0 24 24"><polygon points="12,2 15,9 22,9 17,14 19,22 12,17 5,22 7,14 2,9 9,9"/></svg>`;
                
                gameState.revealed++;
                gameState.multiplier = calculateMultiplier(gameState.minesCount, gameState.revealed);
                multiplierDisplay.textContent = gameState.multiplier.toFixed(2) + 'x';

                // Check if all safe cells revealed
                if (gameState.revealed >= 25 - gameState.minesCount) {
                    endGame(true);
                }
            }
        }

        function endGame(won) {
            gameState.gameOver = true;
            gameState.isPlaying = false;

            // Reveal all mines
            document.querySelectorAll('.mine-cell').forEach((cell, i) => {
                cell.classList.add('game-over');
                if (gameState.mines.includes(i) && !cell.classList.contains('mine')) {
                    cell.classList.add('mine');
                    cell.innerHTML = `<svg class="w-6 h-6 text-[#ef4444]" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg>`;
                }
            });

            if (won) {
                const winnings = gameState.bet * gameState.multiplier;
                gameData.balance += winnings;
                gameData.wins++;
                gameStatus.innerHTML = `<p class="text-[#22c55e]">Победа! +${winnings.toFixed(2)} mCoin</p>`;
                showNotification(`+${winnings.toFixed(2)} mCoin`, 'success');
            } else {
                gameData.losses++;
                gameStatus.innerHTML = `<p class="text-[#ef4444]">Вы попали на мину! -${gameState.bet.toFixed(2)} mCoin</p>`;
                mineGrid.classList.add('shake');
                setTimeout(() => mineGrid.classList.remove('shake'), 500);
            }

            updateUI();
            saveData();

            startGameBtn.disabled = false;
            cashoutBtn.disabled = true;
            betAmount.disabled = false;
            minesCountInput.disabled = false;
        }

        function cashout() {
            if (!gameState.isPlaying || gameState.gameOver || gameState.revealed === 0) return;

            const winnings = gameState.bet * gameState.multiplier;
            gameData.balance += winnings;
            gameData.wins++;
            
            gameState.gameOver = true;
            gameState.isPlaying = false;

            // Reveal all mines
            document.querySelectorAll('.mine-cell').forEach((cell, i) => {
                cell.classList.add('game-over');
                if (gameState.mines.includes(i)) {
                    cell.classList.add('mine');
                    cell.innerHTML = `<svg class="w-6 h-6 text-[#ef4444]" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg>`;
                }
            });

            gameStatus.innerHTML = `<p class="text-[#22c55e]">Вы забрали +${winnings.toFixed(2)} mCoin</p>`;
            showNotification(`+${winnings.toFixed(2)} mCoin`, 'success');

            updateUI();
            saveData();

            startGameBtn.disabled = false;
            cashoutBtn.disabled = true;
            betAmount.disabled = false;
            minesCountInput.disabled = false;
        }

        // Leaderboard
        function renderLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            
            // Add current player to list
            const allPlayers = [...fakePlayers, { name: gameData.nickname + ' (Вы)', balance: gameData.balance, isPlayer: true }];
            allPlayers.sort((a, b) => b.balance - a.balance);

            leaderboard.innerHTML = allPlayers.slice(0, 10).map((player, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other';
                const topClass = index === 0 ? 'top-1' : '';
                const playerClass = player.isPlayer ? 'border border-[#f0b429]' : '';
                
                return `
                    <div class="leaderboard-item ${topClass} ${playerClass}">
                        <div class="rank ${rankClass}">${index + 1}</div>
                        <div class="flex-1">
                            <p class="font-medium">${player.name}</p>
                        </div>
                        <div class="flex items-center gap-1">
                            <svg class="w-4 h-4 text-[#f0b429]" fill="currentColor" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"/>
                            </svg>
                            <span class="mono font-bold">${player.balance.toLocaleString()}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ========== EVENT LISTENERS ==========

        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', () => switchSection(item.dataset.section));
        });

        // Profile
        saveNicknameBtn.addEventListener('click', () => {
            const nickname = nicknameInput.value.trim();
            if (nickname.length > 0) {
                gameData.nickname = nickname;
                saveData();
                updateUI();
                showNotification('Никнейм сохранён', 'success');
            }
        });

        // Bonus
        hourlyBonusBtn.addEventListener('click', claimHourlyBonus);
        dailyBonusBtn.addEventListener('click', claimDailyBonus);

        // Game
        startGameBtn.addEventListener('click', startGame);
        cashoutBtn.addEventListener('click', cashout);

        // ========== INIT ==========
        function init() {
            loadData();
            updateUI();
            createGrid();
            updateBonusTimers();
            setInterval(updateBonusTimers, 1000);
        }

        init();
    </script>
</body>
</html>
